name: Check Deployment Status

on:
  workflow_run:
    workflows: ["Deploy to GitHub Pages"]
    types:
      - completed
  schedule:
    # Check deployment status every 6 hours
    - cron: '0 */6 * * *'
  workflow_dispatch: # Allow manual trigger

permissions:
  contents: read
  actions: read
  pages: write
  id-token: write

jobs:
  check-deployment:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Verify deployment workflow completed
        id: verify-deployment
        run: |
          echo "ğŸ” Verifying deployment workflow status..."
          
          # If triggered by workflow_run, check the triggering workflow
          if [ -n "${{ github.event.workflow_run.id }}" ]; then
            WORKFLOW_RUN_ID="${{ github.event.workflow_run.id }}"
            WORKFLOW_CONCLUSION="${{ github.event.workflow_run.conclusion }}"
            
            echo "ğŸ“‹ Triggered by workflow run: $WORKFLOW_RUN_ID"
            echo "ğŸ“Š Workflow conclusion: $WORKFLOW_CONCLUSION"
            
            if [ "$WORKFLOW_CONCLUSION" != "success" ]; then
              echo "âš ï¸ Deployment workflow did not complete successfully ($WORKFLOW_CONCLUSION)"
              echo "âš ï¸ Skipping deployment verification checks"
              echo "skip_checks=true" >> $GITHUB_OUTPUT
            else
              echo "âœ… Deployment workflow completed successfully"
              echo "skip_checks=false" >> $GITHUB_OUTPUT
            fi
          else
            # Manual trigger or scheduled - proceed with checks
            echo "â„¹ï¸ Manual or scheduled trigger - proceeding with checks"
            echo "skip_checks=false" >> $GITHUB_OUTPUT
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Get deployment status
        if: steps.verify-deployment.outputs.skip_checks != 'true'
        id: deployment-status
        run: |
          echo "ğŸ” Checking deployment status..."
          
          # Initialize variables with safe defaults
          DEPLOYMENT_STATUS="not_available"
          DEPLOYMENT_URL=""
          
          # Get the latest deployment status with proper error handling
          # Capture both stdout and stderr, but check exit code
          API_RESPONSE=$(gh api repos/${{ github.repository }}/pages/deployments 2>&1)
          API_EXIT_CODE=$?
          
          # First check: Did the API call fail or return an error response?
          if [ $API_EXIT_CODE -ne 0 ] || echo "$API_RESPONSE" | grep -qE '"(message|error)"' && echo "$API_RESPONSE" | grep -qE '"(status|code)"'; then
            # This is an error response
            ERROR_CODE=$(echo "$API_RESPONSE" | grep -oE '"status"[[:space:]]*:[[:space:]]*[0-9]+' | grep -oE '[0-9]+' | head -1 || echo "")
            echo "âš ï¸ GitHub Pages deployments API returned error (this is normal if Pages uses GitHub Actions deployment)"
            if [ -n "$ERROR_CODE" ]; then
              echo "   Error code: $ERROR_CODE"
            fi
            # Keep default values: DEPLOYMENT_STATUS="not_available", DEPLOYMENT_URL=""
          # Second check: Is this a valid array response?
          elif echo "$API_RESPONSE" | jq -e 'type == "array" and length > 0' >/dev/null 2>&1; then
            # Valid array response - extract data
            EXTRACTED_STATUS=$(echo "$API_RESPONSE" | jq -r '.[0].status // "unknown"' 2>/dev/null || echo "unknown")
            EXTRACTED_URL=$(echo "$API_RESPONSE" | jq -r '.[0].page_url // ""' 2>/dev/null || echo "")
            
            # Validate extracted values are not error JSON or contain JSON structure
            if [ -n "$EXTRACTED_STATUS" ] && ! echo "$EXTRACTED_STATUS" | grep -qE '[{}"]' && [ "$EXTRACTED_STATUS" != "null" ]; then
              DEPLOYMENT_STATUS="$EXTRACTED_STATUS"
            fi
            if [ -n "$EXTRACTED_URL" ] && ! echo "$EXTRACTED_URL" | grep -qE '[{}"]' && [ "$EXTRACTED_URL" != "null" ]; then
              DEPLOYMENT_URL="$EXTRACTED_URL"
            fi
          else
            # API call returned unexpected format
            echo "âš ï¸ GitHub Pages deployments API not available (this is normal if Pages is not configured or using GitHub Actions deployment)"
          fi
          
          # Sanitize output values (remove newlines, ensure single line, only allow safe chars)
          DEPLOYMENT_STATUS=$(echo "$DEPLOYMENT_STATUS" | tr -d '\n\r\t' | sed 's/[^a-zA-Z0-9_\-]//g' | head -c 100)
          DEPLOYMENT_URL=$(echo "$DEPLOYMENT_URL" | tr -d '\n\r\t' | sed 's/[{}"]//g' | head -c 200)
          
          # Ensure status is never empty and doesn't contain JSON
          [ -z "$DEPLOYMENT_STATUS" ] && DEPLOYMENT_STATUS="not_available"
          if echo "$DEPLOYMENT_STATUS" | grep -qE '[{}"]'; then
            DEPLOYMENT_STATUS="not_available"
          fi
          
          # Write to output (ensure no special characters that break GitHub Actions format)
          echo "status=$DEPLOYMENT_STATUS" >> $GITHUB_OUTPUT
          if [ -n "$DEPLOYMENT_URL" ] && ! echo "$DEPLOYMENT_URL" | grep -qE '[{}"]'; then
            echo "url=$DEPLOYMENT_URL" >> $GITHUB_OUTPUT
          else
            echo "url=" >> $GITHUB_OUTPUT
          fi
          
          # Display results (safe to echo these as they're sanitized)
          echo "ğŸ“Š Deployment Status: $DEPLOYMENT_STATUS"
          if [ -n "$DEPLOYMENT_URL" ] && ! echo "$DEPLOYMENT_URL" | grep -qE '[{}"]'; then
            echo "ğŸŒ Deployment URL: $DEPLOYMENT_URL"
          else
            echo "ğŸŒ Deployment URL: N/A"
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Check GitHub Pages settings
        id: pages-settings
        if: steps.verify-deployment.outputs.skip_checks != 'true'
        run: |
          echo "ğŸ”§ Checking GitHub Pages configuration..."
          
          # Initialize with safe default
          PAGES_ENABLED="not_configured"
          
          # Check if Pages is enabled and configured correctly with proper error handling
          # Capture both stdout and stderr, but check exit code
          API_RESPONSE=$(gh api repos/${{ github.repository }}/pages 2>&1)
          API_EXIT_CODE=$?
          
          # First check: Did the API call fail or return an error response?
          if [ $API_EXIT_CODE -ne 0 ] || echo "$API_RESPONSE" | grep -qE '"(message|error)"' && echo "$API_RESPONSE" | grep -qE '"(status|code)"'; then
            # This is an error response
            ERROR_CODE=$(echo "$API_RESPONSE" | grep -oE '"status"[[:space:]]*:[[:space:]]*[0-9]+' | grep -oE '[0-9]+' | head -1 || echo "")
            echo "âš ï¸ GitHub Pages API returned error (Pages may not be enabled)"
            if [ -n "$ERROR_CODE" ]; then
              echo "   Error code: $ERROR_CODE"
            fi
            # Keep default value: PAGES_ENABLED="not_configured"
          # Second check: Is this a valid Pages config object?
          elif echo "$API_RESPONSE" | jq -e 'type == "object" and (has("source") or has("url"))' >/dev/null 2>&1; then
            # Valid Pages config - extract data
            EXTRACTED_CONFIG=$(echo "$API_RESPONSE" | jq -r '.source.branch // .source.path // "not_configured"' 2>/dev/null || echo "not_configured")
            
            # Validate extracted value is not error JSON or contains JSON structure
            if [ -n "$EXTRACTED_CONFIG" ] && ! echo "$EXTRACTED_CONFIG" | grep -qE '[{}"]' && [ "$EXTRACTED_CONFIG" != "null" ]; then
              PAGES_ENABLED="$EXTRACTED_CONFIG"
            fi
          else
            # API call returned unexpected format
            echo "âš ï¸ GitHub Pages API not available (Pages may not be enabled)"
          fi
          
          # Sanitize output value (remove newlines, ensure single line, only allow safe chars)
          PAGES_ENABLED=$(echo "$PAGES_ENABLED" | tr -d '\n\r\t' | sed 's/[^a-zA-Z0-9_\-]//g' | head -c 100)
          [ -z "$PAGES_ENABLED" ] && PAGES_ENABLED="not_configured"
          
          # Ensure value doesn't contain JSON
          if echo "$PAGES_ENABLED" | grep -qE '[{}"]'; then
            PAGES_ENABLED="not_configured"
          fi
          
          # Write to output (ensure no special characters)
          echo "pages_config=$PAGES_ENABLED" >> $GITHUB_OUTPUT
          echo "ğŸ“‹ Pages Configuration: $PAGES_ENABLED"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Test website accessibility
        id: health-check
        if: steps.verify-deployment.outputs.skip_checks != 'true'
        run: |
          echo "ğŸ¥ Running automatic deployment verification..."
          
          # Try to determine the website URL
          # First check if custom domain is configured
          CUSTOM_DOMAIN=""
          if [ -f "public/CNAME" ]; then
            CUSTOM_DOMAIN=$(cat public/CNAME | tr -d '\n\r' | xargs)
            echo "ğŸ“ Found custom domain: $CUSTOM_DOMAIN"
          fi
          
          # Get repository name for GitHub Pages URL
          REPO_NAME=$(echo "${{ github.repository }}" | cut -d'/' -f2)
          USERNAME=$(echo "${{ github.repository }}" | cut -d'/' -f1)
          GITHUB_PAGES_URL="https://${USERNAME}.github.io/${REPO_NAME}/"
          
          # Determine which URL to check
          if [ -n "$CUSTOM_DOMAIN" ]; then
            TEST_URL="https://${CUSTOM_DOMAIN}/"
            echo "ğŸŒ Testing custom domain: $TEST_URL"
          else
            TEST_URL="$GITHUB_PAGES_URL"
            echo "ğŸŒ Testing GitHub Pages URL: $TEST_URL"
          fi
          
          # Wait for deployment to propagate (GitHub Pages can take time)
          echo "â³ Waiting 15 seconds for deployment to propagate..."
          sleep 15
          
          # Retry logic: Try up to 5 times with increasing delays
          MAX_RETRIES=5
          RETRY_DELAY=30
          HTTP_CODE="000"
          ATTEMPT=1
          
          while [ $ATTEMPT -le $MAX_RETRIES ]; do
            echo "ğŸ”„ Attempt $ATTEMPT of $MAX_RETRIES: Checking website accessibility..."
            
            HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 --retry 2 "$TEST_URL" 2>/dev/null || echo "000")
            echo "ğŸ“¡ HTTP Status Code: $HTTP_CODE"
            
            if [ "$HTTP_CODE" = "200" ]; then
              echo "âœ… Website is accessible!"
              echo "accessible=true" >> $GITHUB_OUTPUT
              echo "test_url=$TEST_URL" >> $GITHUB_OUTPUT
              echo "attempts=$ATTEMPT" >> $GITHUB_OUTPUT
              exit 0
            fi
            
            if [ $ATTEMPT -lt $MAX_RETRIES ]; then
              echo "â³ Waiting ${RETRY_DELAY} seconds before retry..."
              sleep $RETRY_DELAY
              RETRY_DELAY=$((RETRY_DELAY + 15))
            fi
            
            ATTEMPT=$((ATTEMPT + 1))
          done
          
          # All retries failed
          echo "accessible=false" >> $GITHUB_OUTPUT
          echo "test_url=$TEST_URL" >> $GITHUB_OUTPUT
          echo "attempts=$MAX_RETRIES" >> $GITHUB_OUTPUT
          
          if [ "$HTTP_CODE" = "404" ]; then
            echo "âŒ Website returned 404 after $MAX_RETRIES attempts - deployment may not be complete"
            echo "error=404_not_found" >> $GITHUB_OUTPUT
          elif [ "$HTTP_CODE" = "000" ]; then
            echo "âš ï¸ Could not connect to website after $MAX_RETRIES attempts (timeout or DNS issue)"
            echo "error=connection_failed" >> $GITHUB_OUTPUT
          else
            echo "âš ï¸ Website returned HTTP $HTTP_CODE after $MAX_RETRIES attempts"
            echo "error=http_${HTTP_CODE}" >> $GITHUB_OUTPUT
          fi

      - name: Check workflow run status
        id: workflow-status
        if: steps.verify-deployment.outputs.skip_checks != 'true'
        run: |
          echo "ğŸ” Checking latest workflow run status..."
          
          # Get the latest workflow run for deploy-pages
          WORKFLOW_RUN=$(gh run list --workflow=deploy-pages.yml --limit 1 --json conclusion,status,url --jq '.[0]' 2>/dev/null || echo '{"conclusion":"unknown","status":"unknown"}')
          
          CONCLUSION=$(echo "$WORKFLOW_RUN" | jq -r '.conclusion // "unknown"')
          STATUS=$(echo "$WORKFLOW_RUN" | jq -r '.status // "unknown"')
          URL=$(echo "$WORKFLOW_RUN" | jq -r '.url // ""')
          
          echo "conclusion=$CONCLUSION" >> $GITHUB_OUTPUT
          echo "status=$STATUS" >> $GITHUB_OUTPUT
          echo "url=$URL" >> $GITHUB_OUTPUT
          
          echo "ğŸ“Š Workflow Conclusion: $CONCLUSION"
          echo "ğŸ“Š Workflow Status: $STATUS"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Auto-fix common issues
        id: auto-fix
        if: steps.verify-deployment.outputs.skip_checks != 'true' && (steps.workflow-status.outputs.conclusion == 'failure' || steps.health-check.outputs.accessible == 'false')
        run: |
          echo "ğŸ”§ Attempting to auto-fix deployment issues..."
          
          FIXED=false
          ERROR_TYPE="${{ steps.health-check.outputs.error }}"
          WORKFLOW_CONCLUSION="${{ steps.workflow-status.outputs.conclusion }}"
          TEST_URL="${{ steps.health-check.outputs.test_url }}"
          
          # If workflow failed, try to re-run it
          if [ "$WORKFLOW_CONCLUSION" = "failure" ]; then
            echo "ğŸ”„ Workflow failed - attempting to re-trigger deployment..."
            if gh workflow run deploy-pages.yml 2>/dev/null; then
              echo "âœ… Re-triggered deployment workflow"
              FIXED=true
              echo "fix_applied=retrigger_workflow" >> $GITHUB_OUTPUT
              echo "accessible=false" >> $GITHUB_OUTPUT
            else
              echo "âš ï¸ Could not re-trigger workflow automatically"
              echo "fix_applied=retrigger_failed" >> $GITHUB_OUTPUT
            fi
          elif [ "$ERROR_TYPE" = "404_not_found" ] || [ "$ERROR_TYPE" = "connection_failed" ]; then
            echo "âš ï¸ Deployment issue detected - waiting additional time for propagation..."
            echo "ğŸ’¡ Waiting 90 seconds and checking again..."
            sleep 90
            
            # Final re-check
            HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 --retry 3 "$TEST_URL" 2>/dev/null || echo "000")
            echo "ğŸ“¡ Final check HTTP Status Code: $HTTP_CODE"
            
            if [ "$HTTP_CODE" = "200" ]; then
              echo "âœ… Website is now accessible after extended wait!"
              FIXED=true
              echo "fix_applied=extended_wait_success" >> $GITHUB_OUTPUT
              echo "accessible=true" >> $GITHUB_OUTPUT
            else
              echo "âš ï¸ Still getting $HTTP_CODE after extended wait"
              echo "ğŸ’¡ This could be a DNS propagation issue, deployment still in progress, or configuration problem"
              echo "fix_applied=extended_wait_failed" >> $GITHUB_OUTPUT
              echo "accessible=false" >> $GITHUB_OUTPUT
            fi
          else
            echo "âš ï¸ Issue detected but no automatic fix available"
            echo "fix_applied=none" >> $GITHUB_OUTPUT
            echo "accessible=false" >> $GITHUB_OUTPUT
          fi
          
          echo "fixed=$FIXED" >> $GITHUB_OUTPUT
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create status report
        if: steps.verify-deployment.outputs.skip_checks != 'true'
        run: |
          echo "ğŸ“Š Creating deployment status report..."
          
          cat << EOF >> deployment-status.md
          # ğŸš€ Deployment Status Report
          
          **Generated:** $(date -u +"%Y-%m-%d %H:%M:%S UTC")
          
          ## ğŸ“‹ Summary
          
          - **Deployment Status:** ${{ steps.deployment-status.outputs.status }}
          - **Website Accessible:** ${{ steps.health-check.outputs.accessible == 'true' && 'âœ… Yes' || 'âŒ No' }}
          - **Workflow Status:** ${{ steps.workflow-status.outputs.conclusion }}
          - **Test URL:** ${{ steps.health-check.outputs.test_url }}
          
          ## ğŸ” Details
          
          ### Deployment Information
          - **Status:** \`${{ steps.deployment-status.outputs.status || 'Unknown' }}\`\`
          - **URL:** ${{ steps.deployment-status.outputs.url || 'N/A' }}
          
          ### GitHub Pages Configuration
          - **Config:** \`${{ steps.pages-settings.outputs.pages_config }}\`
          
          ### Health Check
          - **HTTP Status:** ${{ steps.health-check.outputs.error || '200 OK' }}
          - **Accessible:** ${{ steps.health-check.outputs.accessible == 'true' && 'âœ…' || 'âŒ' }}
          
          ### Workflow Status
          - **Conclusion:** \`${{ steps.workflow-status.outputs.conclusion }}\`
          - **Status:** \`${{ steps.workflow-status.outputs.status }}\`
          - **Details:** ${{ steps.workflow-status.outputs.url }}
          
          ### Auto-Fix Attempts
          - **Fix Applied:** ${{ steps.auto-fix.outputs.fix_applied || 'None' }}
          - **Fixed:** ${{ steps.auto-fix.outputs.fixed == 'true' && 'âœ…' || 'âŒ' }}
          
          ## âœ… Next Steps
          
          $([ "${{ steps.health-check.outputs.accessible }}" = "true" ] && echo "âœ… **Deployment successful!** Your website is live and accessible." || echo "âŒ **Deployment issue detected.** Please check the workflow logs for details.")
          
          $([ "${{ steps.workflow-status.outputs.conclusion }}" = "failure" ] && echo "âš ï¸ **Workflow failed.** Check the Actions tab for error details." || echo "")
          
          EOF
          
          cat deployment-status.md

      - name: Comment on PR or create issue (if failed)
        if: steps.verify-deployment.outputs.skip_checks != 'true' && steps.health-check.outputs.accessible == 'false' && steps.auto-fix.outputs.fixed != 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const statusReport = fs.readFileSync('deployment-status.md', 'utf8');
            
            // Try to find associated PR
            const prs = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              head: `${context.repo.owner}:${context.ref.replace('refs/heads/', '')}`
            });
            
            if (prs.data.length > 0) {
              // Comment on PR
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: prs.data[0].number,
                body: `## âš ï¸ Deployment Check Failed\n\n${statusReport}\n\nThis is an automated check. Please review the deployment status.`
              });
            } else {
              // Create an issue if no PR found
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `ğŸš¨ Deployment Check Failed - ${new Date().toISOString().split('T')[0]}`,
                body: `## âš ï¸ Deployment Check Failed\n\n${statusReport}\n\nThis is an automated check. Please review the deployment status.`,
                labels: ['deployment', 'automated']
              });
            }

      - name: Deployment Status Summary
        if: always()
        run: |
          echo "## ğŸš€ Deployment Verification Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          IS_ACCESSIBLE="${{ steps.health-check.outputs.accessible }}"
          TEST_URL="${{ steps.health-check.outputs.test_url }}"
          WORKFLOW_STATUS="${{ steps.workflow-status.outputs.conclusion }}"
          FIXED="${{ steps.auto-fix.outputs.fixed }}"
          
          if [ "$IS_ACCESSIBLE" = "true" ] || [ "$FIXED" = "true" ]; then
            echo "### âœ… Deployment Successful!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "ğŸ‰ Your website is **live and accessible**!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**ğŸŒ Website URL:** [$TEST_URL]($TEST_URL)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            if [ "$FIXED" = "true" ]; then
              echo "ğŸ’¡ *Note: Deployment required additional time to propagate, but is now working.*" >> $GITHUB_STEP_SUMMARY
            fi
          else
            echo "### âŒ Deployment Verification Failed" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "âš ï¸ The website is not accessible at this time." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**ğŸŒ Tested URL:** $TEST_URL" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Possible reasons:**" >> $GITHUB_STEP_SUMMARY
            echo "- Deployment is still propagating (can take 5-10 minutes)" >> $GITHUB_STEP_SUMMARY
            echo "- DNS propagation delay (if using custom domain)" >> $GITHUB_STEP_SUMMARY
            echo "- GitHub Pages configuration issue" >> $GITHUB_STEP_SUMMARY
            echo "- Build or deployment error" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Next steps:**" >> $GITHUB_STEP_SUMMARY
            echo "1. Check the 'Deploy to GitHub Pages' workflow status" >> $GITHUB_STEP_SUMMARY
            echo "2. Verify GitHub Pages settings in repository Settings â†’ Pages" >> $GITHUB_STEP_SUMMARY
            echo "3. Wait 10-15 minutes and check again" >> $GITHUB_STEP_SUMMARY
            echo "4. Review the detailed status report in the artifacts" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**ğŸ“Š Quick Status:**" >> $GITHUB_STEP_SUMMARY
          echo "- Website Accessible: $([ "$IS_ACCESSIBLE" = "true" ] || [ "$FIXED" = "true" ] && echo "âœ… Yes" || echo "âŒ No")" >> $GITHUB_STEP_SUMMARY
          echo "- Workflow Status: $([ "$WORKFLOW_STATUS" = "success" ] && echo "âœ… Success" || echo "âš ï¸ $WORKFLOW_STATUS")" >> $GITHUB_STEP_SUMMARY
          echo "- Auto-fix Applied: $([ "$FIXED" = "true" ] && echo "âœ… Yes" || echo "âŒ No")" >> $GITHUB_STEP_SUMMARY
          
          # Also print to console
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          if [ "$IS_ACCESSIBLE" = "true" ] || [ "$FIXED" = "true" ]; then
            echo "âœ… DEPLOYMENT VERIFICATION: SUCCESS"
            echo "ğŸŒ Website URL: $TEST_URL"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          else
            echo "âŒ DEPLOYMENT VERIFICATION: FAILED"
            echo "ğŸŒ Tested URL: $TEST_URL"
            echo "ğŸ’¡ Check the workflow logs and status report for details"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          fi

      - name: Upload status report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: deployment-status-report
          path: deployment-status.md
          retention-days: 7
